<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактировать Сеанс - WellnessWave</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Редактировать Сеанс</h1>
        <form method="POST">
            <div class="mb-3">
                <label for="client_id" class="form-label">Клиент</label>
                <select class="form-select" id="client_id" name="client_id" required>
                    <option value="">Выберите клиента</option>
                    {% for client in clients %}
                    <option value="{{ client.id }}" data-name="{{ client.name_client }}"
                            {% if session.client_id==client.id %}selected{% endif %}>
                        {{ client.name_client }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <input type="hidden" id="hidden_name_client" name="name_client" value="{{ session.name_client }}">

            <div class="mb-3">
                <label for="master_id" class="form-label">Мастер</label>
                <select class="form-select" id="master_id" name="master_id" required>
                    <option value="">Выберите мастера</option>
                    {% for user in users %}
                    <option value="{{ user.master_id }}" data-name="{{ user.name_master }}"
                            {% if session.master_id==user.master_id %}selected{% endif %}>
                        {{ user.name_master }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <input type="hidden" id="hidden_name_master" name="name_master" value="{{ session.name_master }}">

            <div class="mb-3">
                <label for="address_id" class="form-label">Адрес</label>
                <select class="form-select" id="address_id" name="address_id" required>
                    <option value="">Выберите адрес</option>
                    {% for address in addresses %}
                    <option value="{{ address.id }}" {% if session.address_id==address.id %}selected{% endif %}>
                        {{ address.address }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="procedure_type" class="form-label">Тип Процедуры</label>
                <input type="text" class="form-control" id="procedure_type" name="procedure_type" value="{{ session.procedure_type }}" required>
            </div>

            <div class="mb-3">
                <label for="date" class="form-label">Дата и Время</label>
                <input type="datetime-local" class="form-control" id="date" name="date" value="{{ session.date.isoformat() }}" required>
            </div>

            <div class="mb-3">
                <label for="payment_status" class="form-label">Статус Оплаты</label>
                <input type="text" class="form-control" id="payment_status" name="payment_status" value="{{ session.payment_status }}">
            </div>

            <div class="mb-3">
                <label for="details" class="form-label">Детали</label>
                <textarea class="form-control" id="details" name="details">{{ session.details }}</textarea>
            </div>

            <div class="mb-3">
                <label for="telegram_chat_id" class="form-label">Telegram Chat ID (если доступен)</label>
                <input type="text" class="form-control" id="telegram_chat_id" name="telegram_chat_id" value="{{ session.telegram_chat_id }}">
            </div>

            <button type="submit" class="btn btn-primary">Сохранить Изменения</button>
            <a href="{{ url_for('manage_sessions') }}" class="btn btn-secondary">Отмена</a>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var clientSelect = document.getElementById('client_id');
            var masterSelect = document.getElementById('master_id');
            var hiddenNameClientInput = document.getElementById('hidden_name_client');
            var hiddenNameMasterInput = document.getElementById('hidden_name_master');

            function updateHiddenField(selectElement, hiddenInput) {
                var selectedOption = selectElement.options[selectElement.selectedIndex];
                var name = selectedOption.getAttribute('data-name');
                if (name) {
                    hiddenInput.value = name;
                }
            }

            clientSelect.addEventListener('change', function () {
                updateHiddenField(clientSelect, hiddenNameClientInput);
            });

            masterSelect.addEventListener('change', function () {
                updateHiddenField(masterSelect, hiddenNameMasterInput);
            });

            if (clientSelect.selectedIndex >= 0) {
                updateHiddenField(clientSelect, hiddenNameClientInput);
            }

            if (masterSelect.selectedIndex >= 0) {
                updateHiddenField(masterSelect, hiddenNameMasterInput);
            }
        });
    </script>
</body>
</html>
